<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MorAI</title>

<style>
    :root {
        --bg: #f5f5f5;
        --text: #222;
        --bubble-user: #007bff;
        --bubble-ai: #e6e6e6;
        --left-bg: #ffffff;
    }
    .dark {
        --bg: #0f0f0f;
        --text: #ffffff;
        --bubble-user: #008cff;
        --bubble-ai: #1c1c1c;
        --left-bg: #111;
    }

    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        height: 100vh;
        overflow: hidden;
    }

    /* SOL PANEL */
    .sidebar {
        width: 260px;
        background: var(--left-bg);
        border-right: 1px solid #3333;
        display: flex;
        flex-direction: column;
        padding: 15px;
    }
    .sidebar h2 { margin: 0 0 10px 0; }
    .new-chat-btn {
        padding: 10px;
        background: #00875a;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 12px;
    }
    .chat-list {
        flex: 1;
        overflow-y: auto;
    }
    .chat-item {
        background: #007bff22;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 6px;
        cursor: pointer;
    }
    .chat-item:hover { background: #007bff33; }

    .delete-btn {
        margin-top: 10px;
        padding: 8px;
        background: #ff4444;
        text-align: center;
        color: #fff;
        border-radius: 5px;
        cursor: pointer;
    }

    /* DARK MODE BUTTON */
    .mode-btn {
        margin-top: 10px;
        padding: 8px;
        background: #444;
        text-align: center;
        color: #fff;
        border-radius: 5px;
        cursor: pointer;
    }

    /* ANA CHAT ALANI */
    .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    .messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
    }
    .bubble {
        max-width: 70%;
        padding: 12px 14px;
        border-radius: 12px;
        margin-bottom: 12px;
        white-space: pre-line;
    }
    .user { background: var(--bubble-user); color: white; margin-left: auto; }
    .ai { background: var(--bubble-ai); color: var(--text); margin-right: auto; }

    /* Gƒ∞Rƒ∞≈û ALANI */
    .input-area {
        padding: 15px;
        display: flex;
        gap: 10px;
        border-top: 1px solid #4444;
    }
    input {
        flex: 1;
        padding: 12px;
        font-size: 16px;
        border-radius: 8px;
        border: 1px solid #666;
        background: var(--left-bg);
        color: var(--text);
    }
    button.send-btn {
        padding: 12px 18px;
        background: #00875a;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
</style>
</head>

<body class="dark">

<!-- SOL PANEL -->
<div class="sidebar">
    <h2>Sohbetler</h2>
    <div class="new-chat-btn" onclick="newChat()">+ Yeni Sohbet</div>

    <div class="chat-list" id="chatList"></div>

    <div class="delete-btn" onclick="deleteChat()">Sohbeti Sil</div>
    <div class="mode-btn" onclick="toggleMode()">üåô / ‚òÄÔ∏è Mod Deƒüi≈ütir</div>
</div>

<!-- CHAT ANA PANEL -->
<div class="chat-container">
    <div class="messages" id="messages"></div>

    <div class="input-area">
        <input id="msgInput" placeholder="Mesaj yaz..." onkeydown="if(event.key==='Enter'){sendMessage()}">
        <button class="send-btn" onclick="sendMessage()">G√∂nder</button>
    </div>
</div>

<script>
/* ==============================
   GLOBAL DEƒûƒ∞≈ûKENLER
================================= */
let chats = JSON.parse(localStorage.getItem("morai_chats") || "[]");
let currentChat = null;

/* ==============================
   MODE / TEMA
================================= */
function toggleMode() {
    document.body.classList.toggle("dark");
    localStorage.setItem("morai_mode", document.body.classList.contains("dark") ? "dark" : "light");
}

(function loadMode() {
    const mode = localStorage.getItem("morai_mode");
    if (mode === "light") document.body.classList.remove("dark");
})();

/* ==============================
   SOHBET Y√ñNETƒ∞Mƒ∞
================================= */
function renderChatList() {
    let list = document.getElementById("chatList");
    list.innerHTML = "";
    chats.forEach((c, i) => {
        let div = document.createElement("div");
        div.className = "chat-item";
        div.textContent = c.title || "Yeni Sohbet";
        div.onclick = () => loadChat(i);
        list.appendChild(div);
    });
}

function newChat() {
    const chat = { title: "Yeni Sohbet", messages: [] };
    chats.push(chat);
    currentChat = chats.length - 1;
    saveChats();
    renderChatList();
    renderMessages();
}

function saveChats() {
    localStorage.setItem("morai_chats", JSON.stringify(chats));
}

function loadChat(i) {
    currentChat = i;
    renderMessages();
}

function deleteChat() {
    if (currentChat == null) return alert("Sohbet se√ßili deƒüil.");
    chats.splice(currentChat, 1);
    currentChat = null;
    saveChats();
    renderChatList();
    renderMessages();
}

/* ==============================
   MESAJ G√ñR√úNT√úLEME
================================= */
function renderMessages() {
    const box = document.getElementById("messages");
    box.innerHTML = "";

    if (currentChat == null) return;

    chats[currentChat].messages.forEach(msg => {
        const div = document.createElement("div");
        div.className = "bubble " + msg.role;
        div.textContent = msg.content;
        box.appendChild(div);
    });

    box.scrollTop = box.scrollHeight;
}

/* ==============================
   YAZMA ANƒ∞MASYONU
================================= */
function typingBubble(show=true) {
    const box = document.getElementById("messages");

    if (show) {
        const div = document.createElement("div");
        div.className = "bubble ai";
        div.id = "typing";
        div.textContent = "Yazƒ±yor...";
        box.appendChild(div);
    } else {
        const t = document.getElementById("typing");
        if (t) t.remove();
    }

    box.scrollTop = box.scrollHeight;
}

/* ==============================
   MESAJ G√ñNDERME
================================= */
async function sendMessage() {
    const input = document.getElementById("msgInput");
    let text = input.value.trim();
    if (!text) return;

    if (currentChat == null) newChat();

    chats[currentChat].messages.push({ role: "user", content: text });
    saveChats();
    renderMessages();
    input.value = "";

    typingBubble(true);

    // BACKEND API √áAƒûRISI
    const response = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text })
    });
    const data = await response.json();

    typingBubble(false);

    chats[currentChat].messages.push({ role: "ai", content: data.reply });
    saveChats();
    renderMessages();
}

/* ==============================
   UYGULAMA BA≈ûLANGICI
================================= */
renderChatList();
renderMessages();
</script>

</body>
</html>
