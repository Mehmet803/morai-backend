<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MorAI</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --panel:#ffffff;
      --panel2:#f9fafb;
      --border:#e5e7eb;
      --text:#0f172a;
      --muted:#6b7280;
      --accent:#10b981;
      --accentSoft:#d1fae5;

      --bubbleUser:#10b981;
      --bubbleAI:#eef2f7;

      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --shadow2: 0 8px 20px rgba(2,6,23,.10);

      --btn:#111827;
      --btnText:#fff;

      --chip:#11182710;
      --chipText:#111827;

      --inputBg:#ffffff;
      --inputBorder:#d1d5db;
    }

    body.dark{
      --bg:#020617;
      --panel:#020617;
      --panel2:#0b1220;
      --border:#1f2937;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#22c55e;
      --accentSoft:#052e16;

      --bubbleUser:#16a34a;
      --bubbleAI:#0b1220;

      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --shadow2: 0 8px 20px rgba(0,0,0,.35);

      --btn:#111827;
      --btnText:#fff;

      --chip:#ffffff12;
      --chipText:#e5e7eb;

      --inputBg:#020617;
      --inputBorder:#334155;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 500px at 15% 0%, rgba(16,185,129,.16), transparent 60%),
        radial-gradient(900px 500px at 85% 10%, rgba(56,189,248,.12), transparent 60%),
        var(--bg);
      color:var(--text);
      height:100vh;
      overflow:hidden;
      display:flex;
    }

    /* Layout */
    .app{width:100%; display:flex; height:100vh; max-width:1400px; margin:0 auto;}

    /* Sidebar */
    .sidebar{
      width:290px;
      background:linear-gradient(to bottom, var(--panel), var(--panel2));
      border-right:1px solid var(--border);
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:6px 4px;
    }
    .brand-left{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .logo{
      width:28px;height:28px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #a7f3d0, #22c55e);
      box-shadow: 0 0 18px rgba(34,197,94,.55);
    }
    .brand-title{
      font-weight:700;
      font-size:16px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .pill{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      background:var(--accentSoft);
      color:var(--accent);
      border:1px solid rgba(34,197,94,.25);
      white-space:nowrap;
    }

    .btn{
      border:none;
      background:var(--accent);
      color:#fff;
      font-weight:600;
      border-radius:10px;
      padding:10px 12px;
      cursor:pointer;
      box-shadow: 0 10px 18px rgba(16,185,129,.25);
      display:flex; align-items:center; justify-content:center;
      gap:8px;
      font-size:14px;
    }
    .btn:hover{filter:brightness(1.03)}
    .btn:active{transform:translateY(1px)}

    .sidebar-tools{
      display:flex; gap:8px; align-items:center;
    }
    .chip-btn{
      flex:1;
      border:1px solid var(--border);
      background:var(--panel);
      color:var(--text);
      border-radius:999px;
      padding:8px 10px;
      cursor:pointer;
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .chip-btn:hover{background:rgba(148,163,184,.12)}

    .chatlist{
      flex:1;
      overflow:auto;
      padding:4px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.25);
      backdrop-filter: blur(10px);
    }
    body.dark .chatlist{background: rgba(2,6,23,.35)}
    .chat-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:9px 10px;
      border-radius:10px;
      cursor:pointer;
      user-select:none;
      margin-bottom:6px;
      border:1px solid transparent;
    }
    .chat-item:hover{background:rgba(148,163,184,.16)}
    .chat-item.active{
      background:var(--accentSoft);
      border:1px solid rgba(34,197,94,.25);
    }
    .chat-title{
      flex:1;
      min-width:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size:13px;
      color:var(--text);
    }
    .chat-meta{
      display:flex;
      align-items:center;
      gap:6px;
      color:var(--muted);
      font-size:11px;
      white-space:nowrap;
    }
    .menu-wrap{ position:relative; }
    .menu-btn{
      border:none;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-size:18px;
      padding:0 6px;
      line-height:1;
      border-radius:8px;
    }
    .menu-btn:hover{background:rgba(148,163,184,.16); color:var(--text)}
    .menu{
      position:absolute;
      right:0;
      top:28px;
      width:170px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:12px;
      box-shadow: var(--shadow2);
      overflow:hidden;
      display:none;
      z-index:50;
    }
    .menu.open{display:block;}
    .menu-item{
      padding:10px 12px;
      font-size:13px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      color:var(--text);
    }
    .menu-item:hover{background:rgba(148,163,184,.14)}
    .menu-item.danger{color:#ef4444}
    .menu-item.danger:hover{background:rgba(239,68,68,.10)}

    .footer-hint{
      font-size:11px;
      color:var(--muted);
      padding:0 4px;
      line-height:1.4;
    }

    /* Main */
    .main{flex:1; display:flex; flex-direction:column; height:100%;}
    .topbar{
      height:56px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 18px;
      background: rgba(255,255,255,.45);
      backdrop-filter: blur(10px);
    }
    body.dark .topbar{background: rgba(2,6,23,.55)}
    .topbar-left{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .topbar-title{
      font-weight:700;
      font-size:14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .topbar-sub{
      font-size:11px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .messages{
      flex:1;
      overflow:auto;
      padding:18px 20px 10px;
      position:relative;
    }

    /* Empty state */
    .empty{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .empty-card{
      width:min(560px, 100%);
      border:1px solid var(--border);
      border-radius:16px;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      padding:18px 16px;
      text-align:center;
    }
    body.dark .empty-card{background: rgba(2,6,23,.65)}
    .empty-title{
      font-weight:800;
      font-size:18px;
      margin:6px 0 6px;
    }
    .empty-sub{
      color:var(--muted);
      font-size:13px;
      margin:0 0 12px;
    }
    .empty-actions{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
    }
    .quick{
      border:1px solid var(--border);
      background:var(--panel);
      color:var(--text);
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      font-size:12px;
    }
    .quick:hover{background:rgba(148,163,184,.14)}

    /* Bubbles */
    .row{display:flex; margin-bottom:10px;}
    .row.user{justify-content:flex-end;}
    .bubble{
      max-width:72%;
      padding:11px 13px;
      border-radius:16px;
      box-shadow: 0 6px 16px rgba(2,6,23,.08);
      white-space:pre-wrap;
      word-wrap:break-word;
      font-size:14px;
      line-height:1.45;
    }
    body.dark .bubble{box-shadow: 0 6px 18px rgba(0,0,0,.35)}
    .bubble.user{
      background:var(--bubbleUser);
      color:#ecfdf5;
      border-bottom-right-radius:6px;
    }
    .bubble.ai{
      background:var(--bubbleAI);
      color:var(--text);
      border:1px solid rgba(148,163,184,.18);
      border-bottom-left-radius:6px;
    }

    .attachments{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .att{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(148,163,184,.12);
      font-size:12px;
      color:var(--text);
    }
    .att small{color:var(--muted)}
    .att img{
      max-width:260px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,.25);
      display:block;
    }
    /* Typing */
    .typing{
      display:inline-flex;
      gap:4px;
      align-items:center;
    }
    .dot{
      width:6px; height:6px;
      background:#9ca3af;
      border-radius:999px;
      animation: blink 1.2s infinite ease-in-out;
      opacity:.45;
    }
    .dot:nth-child(2){animation-delay:.2s}
    .dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{
      0%,80%,100%{transform:translateY(0);opacity:.35}
      40%{transform:translateY(-2px);opacity:1}
    }

    /* Composer */
    .composer{
      border-top:1px solid var(--border);
      padding:12px 14px;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
    }
    body.dark .composer{background: rgba(2,6,23,.65)}
    .composer-inner{
      display:flex;
      gap:10px;
      align-items:flex-end;
      border:1px solid var(--inputBorder);
      background:var(--inputBg);
      border-radius:14px;
      padding:10px 10px;
      box-shadow: var(--shadow2);
    }
    body.dark .composer-inner{border-color:var(--inputBorder)}
    .icon-btn{
      border:none;
      background:transparent;
      cursor:pointer;
      padding:8px;
      border-radius:12px;
      color:var(--muted);
      font-size:18px;
      line-height:1;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .icon-btn:hover{background:rgba(148,163,184,.14); color:var(--text)}
    .text{
      flex:1;
      min-height:22px;
      max-height:140px;
      resize:none;
      border:none;
      outline:none;
      font-size:14px;
      line-height:1.45;
      background:transparent;
      color:var(--text);
      padding:8px 4px;
    }
    .send{
      border:none;
      background:var(--accent);
      color:#fff;
      font-weight:700;
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 10px 18px rgba(16,185,129,.25);
    }
    .send:disabled{opacity:.55; cursor:not-allowed}
    .composer-hint{
      font-size:11px;
      color:var(--muted);
      padding:8px 2px 0;
      display:flex;
      justify-content:space-between;
      gap:8px;
    }

    @media (max-width: 900px){
      .sidebar{display:none;}
    }
  </style>
</head>

<body class="dark">
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-left">
          <div class="logo"></div>
          <div class="brand-title">MorAI</div>
        </div>
        <div class="pill">Gemini</div>
      </div>

      <button class="btn" id="newChatBtn">+ Yeni sohbet</button>

      <div class="sidebar-tools">
        <button class="chip-btn" id="themeBtn">üåô / ‚òÄÔ∏è Tema</button>
        <button class="chip-btn" id="clearAllBtn" title="T√ºm sohbetleri temizle">üßπ Temizle</button>
      </div>

      <div class="chatlist" id="chatList"></div>

      <div class="footer-hint">
        ‚Ä¢ Sohbetlerin tarayƒ±cƒ±da kaydolur (localStorage).<br/>
        ‚Ä¢ Sohbet satƒ±rƒ±ndaki <b>‚ãØ</b> men√ºs√ºnden silebilirsin.
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="topbar">
        <div class="topbar-left">
          <div class="topbar-title" id="chatTitle">Yeni sohbet</div>
          <div class="topbar-sub">Enter: g√∂nder ‚Ä¢ Shift+Enter: satƒ±r</div>
        </div>
        <div class="topbar-sub" id="statusText">Hazƒ±r</div>
      </header>

      <section class="messages" id="messages">
        <!-- Empty state -->
        <div class="empty" id="emptyState" style="display:none;">
          <div class="empty-card">
            <div style="font-size:22px;">üëã</div>
            <div class="empty-title">Nereden ba≈ülayalƒ±m?</div>
            <p class="empty-sub">Bir mesaj yaz, fotoƒüraf veya dosya ekle.</p>
            <div class="empty-actions">
              <button class="quick" data-q="Kƒ±sa bir plan √ßƒ±kar: Bug√ºn ne yapmalƒ±yƒ±m?">Bug√ºn plan</button>
              <button class="quick" data-q="Bir paragraf motivasyon c√ºmlesi yaz">Motivasyon</button>
              <button class="quick" data-q="Bana 5 maddede √ºretkenlik √∂nerisi ver">√úretkenlik</button>
              <button class="quick" data-q="Bu hafta i√ßin bir okuma listesi √∂ner">Okuma listesi</button>
            </div>
          </div>
        </div>
      </section>

      <section class="composer">
        <div class="composer-inner">
          <!-- Attach -->
          <button class="icon-btn" id="attachBtn" title="Dosya / fotoƒüraf ekle">üìé</button>
          <input id="fileInput" type="file" multiple hidden />

          <!-- Text -->
          <textarea id="input" class="text" placeholder="Mesaj yaz..."></textarea>

          <!-- Send -->
          <button class="send" id="sendBtn">
            G√∂nder <span style="opacity:.9">‚û§</span>
          </button>
        </div>

        <div class="composer-hint">
          <span>Dosyalar sohbet i√ßinde g√∂r√ºn√ºr ve kaydolur.</span>
          <span id="charInfo">0</span>
        </div>
      </section>
    </main>
  </div>
<script>
  // =========================
  // Config
  // =========================
  const BACKEND_URL = "/api/chat"; // backend'in buna uyuyor

  // =========================
  // Storage Keys
  // =========================
  const LS_CHATS = "morai_chats_v2";
  const LS_THEME = "morai_theme_v2";

  // =========================
  // State
  // =========================
  let chats = safeParse(localStorage.getItem(LS_CHATS), []);
  let currentId = chats[0]?.id || null;
  let sending = false;

  // =========================
  // Helpers
  // =========================
  function safeParse(str, fallback){
    try { return str ? JSON.parse(str) : fallback; } catch { return fallback; }
  }
  function save(){
    localStorage.setItem(LS_CHATS, JSON.stringify(chats));
  }
  function uid(){
    return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
  }
  function byId(id){
    return chats.find(c => c.id === id) || null;
  }
  function setStatus(text){
    document.getElementById("statusText").textContent = text;
  }
  function closeAllMenus(){
    document.querySelectorAll(".menu.open").forEach(m => m.classList.remove("open"));
  }
  document.addEventListener("click", (e)=>{
    if(!e.target.closest(".menu-wrap")) closeAllMenus();
  });

  // =========================
  // Theme
  // =========================
  function applyThemeFromStorage(){
    const t = localStorage.getItem(LS_THEME);
    if(t === "light") document.body.classList.remove("dark");
    else document.body.classList.add("dark");
  }
  function toggleTheme(){
    document.body.classList.toggle("dark");
    localStorage.setItem(LS_THEME, document.body.classList.contains("dark") ? "dark" : "light");
  }

  // =========================
  // Chat CRUD
  // =========================
  function ensureChat(){
    if(!chats.length){
      const id = uid();
      chats = [{ id, title:"Yeni sohbet", createdAt: Date.now(), messages: [] }];
      currentId = id;
      save();
    }
    if(!currentId) currentId = chats[0].id;
  }

  function newChat(){
    const id = uid();
    chats.unshift({ id, title:"Yeni sohbet", createdAt: Date.now(), messages: [] });
    currentId = id;
    save();
    renderAll();
  }

  function renameChat(id, title){
    const c = byId(id);
    if(!c) return;
    c.title = title || "Yeni sohbet";
    save();
    renderChatList();
    renderHeader();
  }

  function deleteChat(id){
    const c = byId(id);
    if(!c) return;
    const ok = confirm(`"${c.title || "Bu sohbet"}" silinsin mi?`);
    if(!ok) return;
    chats = chats.filter(x => x.id !== id);
    if(!chats.length){
      currentId = null;
      ensureChat();
    } else {
      currentId = chats[0].id;
    }
    save();
    renderAll();
  }

  function clearAll(){
    const ok = confirm("T√ºm sohbetler silinsin mi?");
    if(!ok) return;
    chats = [];
    currentId = null;
    save();
    ensureChat();
    renderAll();
  }

  // =========================
  // Rendering
  // =========================
  function renderHeader(){
    const c = byId(currentId);
    document.getElementById("chatTitle").textContent = c?.title || "Yeni sohbet";
  }

  function renderChatList(){
    const list = document.getElementById("chatList");
    list.innerHTML = "";

    chats.forEach(chat => {
      const item = document.createElement("div");
      item.className = "chat-item" + (chat.id === currentId ? " active" : "");
      item.onclick = () => { currentId = chat.id; renderAll(); };

      const title = document.createElement("div");
      title.className = "chat-title";
      title.textContent = chat.title || "Yeni sohbet";

      const meta = document.createElement("div");
      meta.className = "chat-meta";
      const count = chat.messages?.length || 0;
      meta.textContent = count ? `${count}` : "";

      const menuWrap = document.createElement("div");
      menuWrap.className = "menu-wrap";

      const btn = document.createElement("button");
      btn.className = "menu-btn";
      btn.textContent = "‚ãØ";
      btn.title = "Men√º";
      btn.onclick = (e) => {
        e.stopPropagation();
        closeAllMenus();
        menu.classList.toggle("open");
      };

      const menu = document.createElement("div");
      menu.className = "menu";

      const del = document.createElement("div");
      del.className = "menu-item danger";
      del.innerHTML = `<span>Sil</span><span>üóëÔ∏è</span>`;
      del.onclick = (e) => { e.stopPropagation(); menu.classList.remove("open"); deleteChat(chat.id); };

      menu.appendChild(del);
      menuWrap.appendChild(btn);
      menuWrap.appendChild(menu);

      item.appendChild(title);
      item.appendChild(meta);
      item.appendChild(menuWrap);
      list.appendChild(item);
    });
  }

  function renderMessages(){
    const wrap = document.getElementById("messages");
    const empty = document.getElementById("emptyState");

    [...wrap.querySelectorAll(".row")].forEach(n => n.remove());

    const chat = byId(currentId);
    const msgs = chat?.messages || [];

    if(msgs.length === 0){
      empty.style.display = "flex";
    } else {
      empty.style.display = "none";
    }

    msgs.forEach(m => {
      const row = document.createElement("div");
      row.className = "row " + (m.role === "user" ? "user" : "ai");

      const bubble = document.createElement("div");
      bubble.className = "bubble " + (m.role === "user" ? "user" : "ai");

      if(m.type === "typing"){
        bubble.innerHTML = `<span class="typing">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </span>`;
      } else {
        bubble.textContent = m.content || "";
      }

      row.appendChild(bubble);
      wrap.appendChild(row);
    });

    wrap.scrollTop = wrap.scrollHeight;
  }

  function renderAll(){
    renderChatList();
    renderHeader();
    renderMessages();
  }

  // =========================
  // Composer
  // =========================
  const inputEl = document.getElementById("input");
  const sendBtn = document.getElementById("sendBtn");
  const charInfo = document.getElementById("charInfo");

  inputEl.addEventListener("input", ()=>{
    charInfo.textContent = String(inputEl.value.length);
  });

  inputEl.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      sendMessage();
    }
  });

  document.querySelectorAll(".quick").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const q = btn.getAttribute("data-q") || "";
      inputEl.value = q;
      charInfo.textContent = String(q.length);
      inputEl.focus();
    });
  });

  // =========================
  // Sending
  // =========================
  async function sendMessage(){
    if(sending) return;

    const text = inputEl.value.trim();
    if(!text) return;

    ensureChat();
    const chat = byId(currentId);

    if(chat.title === "Yeni sohbet"){
      chat.title = text.slice(0, 32);
    }

    chat.messages.push({ role:"user", content: text });
    chat.messages.push({ role:"ai", type:"typing", content:"" });

    sending = true;
    sendBtn.disabled = true;
    setStatus("G√∂nderiliyor‚Ä¶");
    save();
    renderAll();

    inputEl.value = "";
    charInfo.textContent = "0";

    try{
      const res = await fetch(BACKEND_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        const history = chat.messages
  .filter(m => m.role !== "typing")
  .slice(-10)
  .map(m => ({
    role: m.role,
    content: m.content
  }));

body: JSON.stringify({
  messages: history
})

      });

      const data = await res.json();

      chat.messages.pop();
      chat.messages.push({ role:"ai", content: data.reply || "Bo≈ü yanƒ±t" });

      setStatus("Hazƒ±r");
      save();
      renderAll();
    } catch(err){
      chat.messages.pop();
      chat.messages.push({ role:"ai", content: "Sunucu hatasƒ±: " + String(err) });
      setStatus("Hata");
      save();
      renderAll();
    } finally{
      sending = false;
      sendBtn.disabled = false;
    }
  }

  // =========================
  // Wire buttons
  // =========================
  document.getElementById("newChatBtn").addEventListener("click", newChat);
  document.getElementById("themeBtn").addEventListener("click", toggleTheme);
  document.getElementById("clearAllBtn").addEventListener("click", clearAll);

  // =========================
  // Init
  // =========================
  applyThemeFromStorage();
  ensureChat();
  renderAll();
  setStatus("Hazƒ±r");
</script>
</body>
</html>
