<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MorAI</title>

<style>
:root{
  --bg:#0f1115; --panel:#16181d; --border:#262a33;
  --text:#e5e7eb; --muted:#9ca3af;
  --user:#2563eb; --ai:#1f2937;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);height:100vh;display:flex}

/* Sidebar */
.sidebar{width:280px;background:var(--panel);border-right:1px solid var(--border);padding:14px;display:flex;flex-direction:column}
.brand{font-weight:700;font-size:18px;margin-bottom:10px}
.new{background:#2563eb;color:#fff;border:none;padding:10px;border-radius:8px;cursor:pointer}
.list{flex:1;margin-top:12px;overflow:auto}
.item{padding:8px 10px;border-radius:8px;display:flex;justify-content:space-between;cursor:pointer}
.item.active{background:#2563eb22}
.menu{background:none;border:none;color:var(--muted);font-size:18px}

/* Main */
.main{flex:1;display:flex;flex-direction:column}
.top{height:50px;border-bottom:1px solid var(--border);padding:0 16px;display:flex;align-items:center}
.messages{flex:1;padding:20px;overflow:auto;position:relative}
.empty{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:var(--muted);text-align:center}
.row{display:flex;margin-bottom:12px}
.row.user{justify-content:flex-end}
.bubble{max-width:70%;padding:12px 14px;border-radius:14px;font-size:14px}
.user .bubble{background:var(--user);color:#fff}
.ai .bubble{background:var(--ai);color:var(--text)}

.typing{opacity:.7}

.composer{border-top:1px solid var(--border);padding:12px;display:flex;gap:8px;background:var(--panel)}
textarea{flex:1;resize:none;border:1px solid var(--border);border-radius:10px;padding:10px;background:#0b0d11;color:var(--text)}
.send{background:#22c55e;border:none;border-radius:10px;padding:0 16px;color:#000;font-weight:600}
.attach{background:none;border:none;font-size:20px;color:var(--muted)}
</style>
</head>

<body>
<div class="sidebar">
  <div class="brand">MorAI</div>
  <button class="new" onclick="newChat()">+ Yeni sohbet</button>
  <div class="list" id="list"></div>
</div>

<div class="main">
  <div class="top" id="title">Yeni sohbet</div>
  <div class="messages" id="msgs">
    <div class="empty" id="empty">Nereden ba≈ülayalƒ±m reis?<br>Mesaj yaz veya dosya at.</div>
  </div>

  <div class="composer">
    <button class="attach" onclick="file.click()">üìé</button>
    <input type="file" id="file" hidden>
    <textarea id="input" placeholder="Yaz bakalƒ±m reis‚Ä¶"></textarea>
    <button class="send" onclick="send()">G√∂nder</button>
  </div>
</div>

<script>
const chats = JSON.parse(localStorage.getItem("morai")||"[]");
let current = 0;
let fileText = "";

const list=document.getElementById("list");
const msgs=document.getElementById("msgs");
const empty=document.getElementById("empty");
const input=document.getElementById("input");
const title=document.getElementById("title");
const file=document.getElementById("file");

function save(){localStorage.setItem("morai",JSON.stringify(chats))}

function newChat(){
  chats.unshift({title:"Yeni sohbet",messages:[]});
  current=0;save();render();
}

function render(){
  list.innerHTML="";
  chats.forEach((c,i)=>{
    const d=document.createElement("div");
    d.className="item"+(i===current?" active":"");
    d.innerHTML=`<span>${c.title}</span><button class="menu" onclick="del(event,${i})">‚ãØ</button>`;
    d.onclick=()=>{current=i;render()};
    list.appendChild(d);
  });
  renderMsgs();
}

function del(e,i){e.stopPropagation();chats.splice(i,1);current=0;save();render()}

function renderMsgs(){
  msgs.querySelectorAll(".row").forEach(r=>r.remove());
  const m=chats[current]?.messages||[];
  empty.style.display=m.length?"none":"flex";
  title.textContent=chats[current]?.title||"Yeni sohbet";

  m.forEach(x=>{
    const r=document.createElement("div");
    r.className="row "+x.role;
    const b=document.createElement("div");
    b.className="bubble"+(x.typing?" typing":"");
    b.textContent=x.text;
    r.appendChild(b);
    msgs.appendChild(r);
  });
  msgs.scrollTop=msgs.scrollHeight;
}

file.onchange=async()=>{
  const f=file.files[0];
  if(!f) return;
  if(f.name.endsWith(".txt")||f.name.endsWith(".md")){
    fileText=await f.text();
    alert("Dosyayƒ± aldƒ±m reis üëç ≈ûimdi sorabilirsin.");
  }else{
    alert("PDF ≈üimdilik yok reis. TXT atarsan okurum.");
  }
  file.value="";
}

async function send(){
  const text=input.value.trim();
  if(!text && !fileText) return;
  if(!chats.length) newChat();

  const chat=chats[current];
  chat.messages.push({role:"user",text});
  chat.messages.push({role:"ai",text:"Yazƒ±yorum reis‚Ä¶",typing:true});
  save();render();
  input.value="";

  const res=await fetch("/api/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:text, file:fileText})
  });
  const data=await res.json();

  chat.messages.pop();
  chat.messages.push({role:"ai",text:data.reply});
  fileText="";
  save();render();
}

render();
</script>
</body>
</html>
