<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MorAI</title>

<style>
:root{
  --bg:#f5f6f8;
  --panel:#ffffff;
  --border:#e5e7eb;
  --text:#111827;
  --muted:#6b7280;
  --bubble-user:#2563eb;
  --bubble-ai:#f3f4f6;
}
body.dark{
  --bg:#0f1115;
  --panel:#16181d;
  --border:#262a33;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --bubble-user:#2563eb;
  --bubble-ai:#1f2937;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
}

/* Sidebar */
.sidebar{
  width:280px;
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:14px;
  display:flex;
  flex-direction:column;
}
.brand{
  font-weight:700;
  font-size:18px;
  margin-bottom:10px;
}
.new-chat{
  background:#2563eb;
  color:#fff;
  border:none;
  padding:10px;
  border-radius:8px;
  cursor:pointer;
}
.chat-list{
  flex:1;
  margin-top:12px;
  overflow:auto;
}
.chat-item{
  padding:8px 10px;
  border-radius:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.chat-item.active{
  background:#2563eb22;
}
.chat-item:hover{
  background:#2563eb11;
}
.menu-btn{
  background:none;
  border:none;
  color:var(--muted);
  font-size:18px;
  cursor:pointer;
}
.bottom-btn{
  margin-top:10px;
  background:var(--bubble-ai);
  border:1px solid var(--border);
  padding:8px;
  border-radius:8px;
  cursor:pointer;
}

/* Main */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
}
.topbar{
  height:50px;
  border-bottom:1px solid var(--border);
  padding:0 16px;
  display:flex;
  align-items:center;
}
.messages{
  flex:1;
  padding:20px;
  overflow:auto;
  position:relative;
}
.empty{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  color:var(--muted);
}
.row{
  margin-bottom:12px;
  display:flex;
}
.row.user{justify-content:flex-end}
.bubble{
  max-width:70%;
  padding:12px 14px;
  border-radius:14px;
  font-size:14px;
}
.bubble.user{
  background:var(--bubble-user);
  color:#fff;
}
.bubble.ai{
  background:var(--bubble-ai);
  color:var(--text);
}

/* Composer */
.composer{
  border-top:1px solid var(--border);
  padding:12px;
  display:flex;
  gap:8px;
  background:var(--panel);
}
textarea{
  flex:1;
  resize:none;
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  background:var(--bg);
  color:var(--text);
}
button.send{
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:10px;
  padding:0 16px;
  cursor:pointer;
}
.icon{
  background:none;
  border:none;
  font-size:20px;
  cursor:pointer;
  color:var(--muted);
}
img.preview{
  max-width:220px;
  border-radius:10px;
  margin-top:8px;
}
</style>
</head>

<body class="dark">
<div class="sidebar">
  <div class="brand">MorAI</div>
  <button class="new-chat" onclick="newChat()">+ Yeni sohbet</button>
  <div class="chat-list" id="chatList"></div>
  <button class="bottom-btn" onclick="toggleTheme()">üåô / ‚òÄÔ∏è Tema</button>
</div>

<div class="main">
  <div class="topbar" id="chatTitle">Yeni sohbet</div>
  <div class="messages" id="messages">
    <div class="empty" id="empty">Nereden ba≈ülayalƒ±m?<br>Mesaj yazabilir, dosya veya fotoƒüraf g√∂nderebilirsin.</div>
  </div>

  <div class="composer">
    <button class="icon" onclick="fileInput.click()">üìé</button>
    <input type="file" id="fileInput" hidden multiple>
    <textarea id="input" rows="1" placeholder="Mesaj yaz..."></textarea>
    <button class="send" onclick="send()">G√∂nder</button>
  </div>
</div>

<script>
const chats = JSON.parse(localStorage.getItem("morai_chats")||"[]");
let current = 0;
const messagesEl = document.getElementById("messages");
const chatListEl = document.getElementById("chatList");
const emptyEl = document.getElementById("empty");
const inputEl = document.getElementById("input");
const fileInput = document.getElementById("fileInput");
let attachments=[];

function save(){localStorage.setItem("morai_chats",JSON.stringify(chats));}

function newChat(){
  chats.unshift({title:"Yeni sohbet",messages:[]});
  current=0; save(); render();
}

function render(){
  chatListEl.innerHTML="";
  chats.forEach((c,i)=>{
    const d=document.createElement("div");
    d.className="chat-item"+(i===current?" active":"");
    d.textContent=c.title;
    d.onclick=()=>{current=i;render()};
    chatListEl.appendChild(d);
  });
  renderMessages();
}

function renderMessages(){
  messagesEl.querySelectorAll(".row").forEach(e=>e.remove());
  const msgs=chats[current]?.messages||[];
  emptyEl.style.display=msgs.length?"none":"flex";
  msgs.forEach(m=>{
    const r=document.createElement("div");
    r.className="row "+m.role;
    const b=document.createElement("div");
    b.className="bubble "+m.role;
    b.textContent=m.text;
    if(m.images){
      m.images.forEach(src=>{
        const img=document.createElement("img");
        img.src=src;
        img.className="preview";
        b.appendChild(img);
      });
    }
    r.appendChild(b);
    messagesEl.appendChild(r);
  });
  messagesEl.scrollTop=messagesEl.scrollHeight;
}

fileInput.onchange=()=>{
  for(const f of fileInput.files){
    if(f.type.startsWith("image/")){
      const r=new FileReader();
      r.onload=()=>attachments.push({type:"image",data:r.result,name:f.name});
      r.readAsDataURL(f);
    }else{
      attachments.push({type:"file",name:f.name});
    }
  }
};

async function send(){
  const text=inputEl.value.trim();
  if(!text && !attachments.length) return;

  if(!chats.length) newChat();
  const chat=chats[current];

  chat.messages.push({
    role:"user",
    text,
    images:attachments.filter(a=>a.type==="image").map(a=>a.data)
  });
  save(); render();
  inputEl.value="";

  const fd=new FormData();
  fd.append("message",text);
  attachments.forEach(a=>{
    if(a.type==="image"){
      const blob=fetch(a.data).then(r=>r.blob());
    }
  });
  fileInput.value="";
  attachments=[];

  const res=await fetch("/api/chat",{method:"POST",body:fd});
  const data=await res.json();
  chat.messages.push({role:"ai",text:data.reply});
  save(); render();
}

function toggleTheme(){
  document.body.classList.toggle("dark");
}
render();
</script>
</body>
</html>
