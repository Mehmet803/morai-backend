<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>MorAI Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    :root {
        --bg: #f4f4f5;
        --panel: #ffffff;
        --text: #111;
        --text-muted: #666;
        --user: #dbeafe;
        --bot: #ffffff;
        --accent: #0f766e;
    }
    body.dark {
        --bg: #020617;
        --panel: #0f172a;
        --text: #eee;
        --text-muted: #999;
        --user: #003f57;
        --bot: #0f172a;
        --accent: #22c55e;
    }
    * { box-sizing: border-box; font-family: system-ui; }
    body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        height: 100vh;
        display: flex;
        overflow: hidden;
    }
    /* Sidebar */
    #sidebar {
        width: 260px;
        background: var(--panel);
        border-right: 1px solid #ddd;
        display: flex;
        flex-direction: column;
    }
    #newChat {
        margin: 10px;
        padding: 10px;
        border-radius: 8px;
        border: none;
        background: var(--accent);
        color: white;
        cursor: pointer;
        font-size: 15px;
    }
    #conversations {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
    }
    .conv {
        padding: 12px;
        background: var(--bot);
        margin-bottom: 8px;
        border-radius: 8px;
        cursor: pointer;
    }
    .conv.active {
        border: 2px solid var(--accent);
    }
    /* Chat area */
    #chat {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    #messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
    }
    .msg {
        max-width: 65%;
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 12px;
        white-space: pre-wrap;
    }
    .user { background: var(--user); margin-left: auto; }
    .bot { background: var(--bot); border: 1px solid #ddd; margin-right: auto; }
    #inputArea {
        padding: 10px;
        display: flex;
        gap: 10px;
        border-top: 1px solid #ccc;
        background: var(--panel);
    }
    #text {
        flex: 1;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #aaa;
        background: var(--bg);
        color: var(--text);
    }
    #send {
        padding: 10px 18px;
        border: none;
        border-radius: 8px;
        background: var(--accent);
        color: white;
        cursor: pointer;
        font-size: 15px;
    }
    #themeBtn {
        margin: 10px;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #aaa;
        background: var(--panel);
        cursor: pointer;
    }
</style>
</head>

<body>

<div id="sidebar">
    <button id="newChat">+ Yeni sohbet</button>
    <button id="themeBtn">üåô / ‚òÄÔ∏è</button>
    <div id="conversations"></div>
</div>

<div id="chat">
    <div id="messages"></div>
    <div id="inputArea">
        <textarea id="text" placeholder="Mesaj Yaz..." rows="2"></textarea>
        <button id="send">G√∂nder</button>
    </div>
</div>

<script>
/* ===============================
   BACKEND URL ‚Äì SADECE BURAYI D√úZELT 
   √∂rnek: const BACKEND_URL = "/api/chat";
   =============================== */
const BACKEND_URL = "/api/chat";

/* --- DATA --- */
let chats = [];
let currentID = null;

/* --- UI RENDER --- */
function renderSidebar() {
    let box = document.getElementById("conversations");
    box.innerHTML = "";
    chats.forEach(c => {
        let div = document.createElement("div");
        div.className = "conv" + (c.id === currentID ? " active" : "");
        div.textContent = c.title;
        div.onclick = () => {
            currentID = c.id;
            renderSidebar();
            renderMessages();
        };
        box.appendChild(div);
    });
}

function renderMessages() {
    let area = document.getElementById("messages");
    area.innerHTML = "";
    let chat = chats.find(c => c.id === currentID);
    if (!chat) return;

    chat.messages.forEach(m => {
        let div = document.createElement("div");
        div.className = "msg " + (m.role === "user" ? "user" : "bot");
        div.textContent = m.content;
        area.appendChild(div);
    });

    area.scrollTop = area.scrollHeight;
}

/* --- CREATE CHAT --- */
function newChat(title = "Yeni sohbet") {
    const id = Date.now().toString();
    chats.unshift({
        id,
        title,
        messages: []
    });
    currentID = id;
    renderSidebar();
    renderMessages();
}

/* --- SEND MESSAGE --- */
async function sendMessage() {
    let text = document.getElementById("text").value.trim();
    if (!text) return;

    let chat = chats.find(c => c.id === currentID);
    if (!chat) {
        newChat(text.slice(0,20));
        chat = chats.find(c => c.id === currentID);
    }

    chat.messages.push({ role: "user", content: text });
    renderMessages();
    document.getElementById("text").value = "";

    // YAZIYOR efekti
    chat.messages.push({ role: "bot", content: "Yazƒ±yor..." });
    renderMessages();

    try {
        const res = await fetch(BACKEND_URL, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ message: text })  // SENƒ∞N BACKEND FORMATIN
        });

        if (!res.ok) {
            throw new Error("Backend hata: " + res.status);
        }

        const data = await res.json();
        const reply = data.reply || "Yanƒ±t alƒ±namadƒ±.";

        // Yazƒ±yor mesajƒ±nƒ± kaldƒ±r
        chat.messages.pop();

        chat.messages.push({ role: "bot", content: reply });
        renderMessages();

    } catch (err) {
        chat.messages.pop();
        chat.messages.push({
            role: "bot",
            content: "Hata: " + err.message
        });
        renderMessages();
    }
}

/* --- EVENTS --- */
document.getElementById("send").onclick = sendMessage;
document.getElementById("newChat").onclick = () => newChat();
document.getElementById("themeBtn").onclick = () =>
    document.body.classList.toggle("dark");

document.getElementById("text").addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

/* INIT */
newChat();

</script>
</body>
</html>
