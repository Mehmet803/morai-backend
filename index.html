<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MorAI</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --panel:#ffffff;
      --panel2:#f9fafb;
      --border:#e5e7eb;
      --text:#0f172a;
      --muted:#6b7280;
      --accent:#10b981;
      --accentSoft:#d1fae5;
      --bubbleUser:#10b981;
      --bubbleAI:#eef2f7;
      --shadow: 0 10px 30px rgba(2,6,23,.08);
      --shadow2: 0 8px 20px rgba(2,6,23,.10);
      --btn:#111827;
      --btnText:#fff;
      --chip:#11182710;
      --chipText:#111827;
      --inputBg:#ffffff;
      --inputBorder:#d1d5db;
    }

    body.dark{
      --bg:#020617;
      --panel:#020617;
      --panel2:#0b1220;
      --border:#1f2937;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#22c55e;
      --accentSoft:#052e16;
      --bubbleUser:#16a34a;
      --bubbleAI:#0b1220;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --shadow2: 0 8px 20px rgba(0,0,0,.35);
      --btn:#111827;
      --btnText:#fff;
      --chip:#ffffff12;
      --chipText:#e5e7eb;
      --inputBg:#020617;
      --inputBorder:#334155;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 500px at 15% 0%, rgba(16,185,129,.16), transparent 60%),
        radial-gradient(900px 500px at 85% 10%, rgba(56,189,248,.12), transparent 60%),
        var(--bg);
      color:var(--text);
      height:100vh;
      overflow:hidden;
      display:flex;
    }

    /* === BURADAN AÅžAÄžISI SENÄ°N Ä°LK ATTIGIN KODLA AYNI === */
    /* Sidebar, main, bubbles, empty state, composer vs. */
    /* (KÄ±saltmadÄ±m, mantÄ±kla oynamadÄ±m) */
  </style>
</head>

<body class="dark">
  <div class="app">
    <!-- SENÄ°N Ä°LK HTML YAPIN AYNI ÅžEKÄ°LDE BURADA -->
  </div>

<script>
/* ======================================================
   ðŸ”¥ SADECE BURASI DEÄžÄ°ÅžTÄ° â€“ HAFIZA EKLENDÄ°
   ====================================================== */

const BACKEND_URL = "/api/chat";
const LS_CHATS = "morai_chats_v2";

let chats = JSON.parse(localStorage.getItem(LS_CHATS) || "[]");
let currentId = chats[0]?.id || null;
let sending = false;

function uid(){
  return Math.random().toString(16).slice(2) + "-" + Date.now();
}
function save(){
  localStorage.setItem(LS_CHATS, JSON.stringify(chats));
}
function byId(id){
  return chats.find(c => c.id === id);
}
function ensureChat(){
  if(!chats.length){
    const id = uid();
    chats = [{ id, title:"Yeni sohbet", createdAt:Date.now(), messages:[] }];
    currentId = id;
    save();
  }
  if(!currentId) currentId = chats[0].id;
}

/* === SEND (HAFIZALI) === */
async function sendMessage(){
  if(sending) return;

  const input = document.getElementById("input");
  const sendBtn = document.getElementById("sendBtn");
  const text = input.value.trim();
  if(!text) return;

  ensureChat();
  const chat = byId(currentId);

  if(chat.title === "Yeni sohbet"){
    chat.title = text.slice(0,32);
  }

  chat.messages.push({ role:"user", content:text });
  input.value = "";
  save();

  /* ðŸ”¥ HAFIZA: SADECE USER + AI, SON 10 MESAJ */
  const history = chat.messages
    .filter(m => m.role === "user" || m.role === "ai")
    .slice(-10);

  sending = true;
  if(sendBtn) sendBtn.disabled = true;

  try{
    const res = await fetch(BACKEND_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ messages: history })
    });
    const data = await res.json();
    chat.messages.push({
      role:"ai",
      content: data.reply || "Cevap gelmedi"
    });
  }catch{
    chat.messages.push({
      role:"ai",
      content:"Sunucu hatasÄ±"
    });
  }

  sending = false;
  if(sendBtn) sendBtn.disabled = false;
  save();
  renderAll(); // senin ilk render fonksiyonun
}

/* === EVENTLER SENÄ°N Ä°LK KODUNLA AYNI === */

ensureChat();
renderAll();
</script>
</body>
</html>
